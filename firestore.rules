rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
     match /{document=**} {
      allow read, write: if true;
    }
    match /menu/{menuId} {
      allow get: if request.auth != null;
      allow update : if request.auth.token.level in ['stall_admin' , 'super_admin']
    }

    function getOrder(orderId){
      return get(/databases/$(database)/documents/orders/$(orderId)).data
    }

    match /orders/{orderId} {
      allow read, list: if (request.auth.uid == getOrder(orderId).user_info.uid
      || resource.data.user_info.uid == request.auth.uid)
    }

  }
}